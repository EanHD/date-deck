<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#ff6b6b">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Date Deck">
<title>Date Deck</title>
<style>
  :root { 
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', system-ui, sans-serif;
    --ios-blue: #007AFF;
    --ios-blue-dark: #0051D0;
    --ios-red: #FF3B30;
    --ios-green: #34C759;
    --ios-orange: #FF9500;
    --ios-purple: #AF52DE;
    --ios-gray: #8E8E93;
    --ios-gray2: #AEAEB2;
    --ios-gray3: #C7C7CC;
    --ios-gray4: #D1D1D6;
    --ios-gray5: #E5E5EA;
    --ios-gray6: #F2F2F7;
    --ios-bg: #F2F2F7;
    --ios-card: #FFFFFF;
    --ios-separator: rgba(60, 60, 67, 0.29);
    --ios-label: #000000;
    --ios-secondary-label: rgba(60, 60, 67, 0.6);
    --ios-tertiary-label: rgba(60, 60, 67, 0.3);
  }
  
  @media (prefers-color-scheme: dark) {
    :root {
      --ios-bg: #000000;
      --ios-card: #1C1C1E;
      --ios-separator: rgba(84, 84, 88, 0.65);
      --ios-label: #FFFFFF;
      --ios-secondary-label: rgba(235, 235, 245, 0.6);
      --ios-tertiary-label: rgba(235, 235, 245, 0.3);
      --ios-gray6: #1C1C1E;
    }
  }
  
  * { 
    box-sizing: border-box; 
    -webkit-tap-highlight-color: transparent;
  }
  
  body { 
    margin: 0; 
    padding: 0;
    background: var(--ios-bg);
    color: var(--ios-label);
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
    line-height: 1.4;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  .container { 
    max-width: 428px; 
    margin: 0 auto; 
    padding: 0;
    min-height: 100vh;
  }
  
  .nav-bar {
    background: var(--ios-card);
    border-bottom: 0.5px solid var(--ios-separator);
    padding: 44px 16px 16px;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }
  
  .nav-title {
    font-size: 34px;
    font-weight: 700;
    letter-spacing: 0.37px;
    margin: 0;
    color: var(--ios-label);
  }
  
  .nav-subtitle {
    font-size: 13px;
    color: var(--ios-secondary-label);
    margin: 4px 0 0;
    font-weight: 400;
  }
  
  .content {
    padding: 0 0 100px;
  }
  
  .section {
    margin-bottom: 35px;
  }
  
  .section-header {
    padding: 0 16px 8px;
    font-size: 13px;
    font-weight: 400;
    color: var(--ios-secondary-label);
    text-transform: uppercase;
    letter-spacing: -0.08px;
  }
  
  .card {
    background: var(--ios-card);
    margin: 0 16px;
    border-radius: 10px;
    overflow: hidden;
    border: 0.5px solid var(--ios-separator);
  }
  
  .card-section {
    padding: 16px;
    border-bottom: 0.5px solid var(--ios-separator);
  }
  
  .card-section:last-child {
    border-bottom: none;
  }
  
  .form-row {
    margin-bottom: 16px;
  }
  
  .form-row:last-child {
    margin-bottom: 0;
  }
  
  textarea, input[type="text"] {
    width: 100%;
    padding: 12px 16px;
    border: none;
    border-radius: 10px;
    background: var(--ios-gray6);
    color: var(--ios-label);
    font-family: inherit;
    font-size: 17px;
    line-height: 1.29;
    -webkit-appearance: none;
    appearance: none;
    outline: none;
    resize: none;
  }
  
  textarea {
    min-height: 100px;
    font-size: 16px;
  }
  
  textarea::placeholder, input::placeholder {
    color: var(--ios-tertiary-label);
  }
  
  .file-input {
    position: relative;
    display: block;
    width: 100%;
  }
  
  .file-input input {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
  }
  
  .file-input-label {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 12px 16px;
    background: var(--ios-gray6);
    border-radius: 10px;
    color: var(--ios-blue);
    font-size: 17px;
    font-weight: 400;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  
  .file-input-label:active {
    background: var(--ios-gray5);
  }
  
  .btn {
    display: block;
    width: 100%;
    padding: 16px;
    border: none;
    border-radius: 10px;
    font-family: inherit;
    font-size: 17px;
    font-weight: 600;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
    -webkit-appearance: none;
    appearance: none;
    outline: none;
    text-decoration: none;
    user-select: none;
    -webkit-user-select: none;
  }
  
  .btn-primary {
    background: var(--ios-blue);
    color: white;
  }
  
  .btn-primary:active {
    background: var(--ios-blue-dark);
    transform: scale(0.98);
  }
  
  .btn-secondary {
    background: var(--ios-gray6);
    color: var(--ios-blue);
  }
  
  .btn-secondary:active {
    background: var(--ios-gray5);
    transform: scale(0.98);
  }
  
  .btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }
  
  .btn-row {
    display: flex;
    gap: 12px;
  }
  
  .draw-section {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--ios-card);
    border-top: 0.5px solid var(--ios-separator);
    padding: 16px;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }
  
  .draw-btn {
    background: var(--ios-blue);
    color: white;
    font-size: 20px;
    font-weight: 700;
    padding: 18px;
    margin-bottom: 8px;
  }
  
  .filter-input {
    margin-bottom: 12px;
  }
  
  .stats {
    text-align: center;
    color: var(--ios-secondary-label);
    font-size: 15px;
    font-weight: 400;
    margin-bottom: 12px;
  }
  
  .result {
    background: var(--ios-blue);
    color: white;
    padding: 24px;
    border-radius: 16px;
    margin: 16px;
    text-align: center;
  }
  
  .result-text {
    font-size: 22px;
    font-weight: 700;
    line-height: 1.27;
    margin-bottom: 8px;
  }
  
  .result-tags {
    font-size: 15px;
    font-weight: 400;
    opacity: 0.8;
  }
  
  .list {
    background: var(--ios-card);
    margin: 0 16px;
    border-radius: 10px;
    overflow: hidden;
    border: 0.5px solid var(--ios-separator);
  }
  
  .list-item {
    padding: 16px;
    border-bottom: 0.5px solid var(--ios-separator);
    cursor: pointer;
    transition: background-color 0.2s ease;
    -webkit-tap-highlight-color: transparent;
  }
  
  .list-item:last-child {
    border-bottom: none;
  }
  
  .list-item:active {
    background: var(--ios-gray6);
  }
  
  .list-item-text {
    font-size: 17px;
    font-weight: 400;
    color: var(--ios-label);
    margin-bottom: 4px;
    line-height: 1.29;
  }
  
  .list-item-tags {
    font-size: 15px;
    color: var(--ios-secondary-label);
    font-weight: 400;
  }
  
  .empty-state {
    text-align: center;
    padding: 60px 40px;
    color: var(--ios-secondary-label);
    font-size: 17px;
    line-height: 1.29;
  }
  
  .loading {
    opacity: 0.5;
    pointer-events: none;
  }
  
  /* iOS-style haptic feedback simulation */
  @keyframes haptic {
    0% { transform: scale(1); }
    50% { transform: scale(0.97); }
    100% { transform: scale(1); }
  }
  
  .haptic {
    animation: haptic 0.1s ease;
  }
  
  /* Safe area handling */
  @supports (padding-bottom: env(safe-area-inset-bottom)) {
    .nav-bar {
      padding-top: max(44px, env(safe-area-inset-top));
    }
    
    .draw-section {
      padding-bottom: max(16px, env(safe-area-inset-bottom));
    }
    
    .content {
      padding-bottom: max(100px, calc(100px + env(safe-area-inset-bottom)));
    }
  }
</style>
</head>
<body>
  <div class="container">
    <div class="nav-bar">
      <h1 class="nav-title">Date Ideas</h1>
      <p class="nav-subtitle">Your personal collection</p>
    </div>

    <div class="content">
      <div class="section">
        <div class="section-header">Add New Ideas</div>
        <div class="card">
          <div class="card-section">
            <div class="form-row">
              <textarea id="bulk" placeholder="Sunset picnic | romantic, outdoors&#10;Mini golf | fun, active&#10;Cooking class | learning, food"></textarea>
            </div>
            <div class="form-row">
              <div class="file-input">
                <input type="file" id="file" accept=".txt,.csv,.md,.list" />
                <label for="file" class="file-input-label">Choose File</label>
              </div>
            </div>
            <div class="btn-row">
              <button id="parse" class="btn btn-primary">Add to Collection</button>
              <button id="sample" class="btn btn-secondary">Examples</button>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-header">Your Collection</div>
        <div class="stats" id="stats">Add some ideas to get started</div>
        <div class="list" id="list">
          <div class="empty-state">
            Tap "Examples" above to see sample date ideas, then add your own!
          </div>
        </div>
      </div>
    </div>

    <div class="draw-section">
      <div class="filter-input">
        <input type="text" id="filter" placeholder="Filter by tag (optional)" />
      </div>
      <button id="draw" class="btn draw-btn">Get Random Idea</button>
      <div id="result" style="display:none"></div>
    </div>
  </div>
<script>
(function(){
  'use strict';
  
  const LS_KEY = "datedeck_items_v3";
  let items = JSON.parse(localStorage.getItem(LS_KEY) || "[]");
  
  // Cache DOM elements
  const el = (id) => document.getElementById(id);
  const bulk = el('bulk');
  const file = el('file');
  const parseBtn = el('parse');
  const listEl = el('list');
  const drawBtn = el('draw');
  const resultEl = el('result');
  const filterEl = el('filter');
  const sampleBtn = el('sample');
  const statsEl = el('stats');
  
  // iOS-style haptic feedback simulation
  function triggerHaptic(element) {
    element.classList.add('haptic');
    setTimeout(() => element.classList.remove('haptic'), 100);
  }
  
  // Utility functions
  function save() { 
    localStorage.setItem(LS_KEY, JSON.stringify(items)); 
  }
  
  function parseLine(line) {
    line = line.trim();
    if (!line) return null;
    const parts = line.split("|").map(s => s.trim());
    return {
      id: Date.now() + Math.random(),
      text: parts[0],
      tags: (parts[1] || "").split(",").map(s => s.trim()).filter(Boolean)
    };
  }
  
  function updateStats() {
    const count = items.length;
    if (count === 0) {
      statsEl.textContent = "Add some ideas to get started";
    } else if (count === 1) {
      statsEl.textContent = "1 idea in your collection";
    } else {
      statsEl.textContent = `${count} ideas in your collection`;
    }
  }
  
  function render() {
    updateStats();
    
    if (items.length === 0) {
      listEl.innerHTML = '<div class="empty-state">Tap "Examples" above to see sample date ideas, then add your own!</div>';
      return;
    }
    
    listEl.innerHTML = "";
    listEl.className = "list";
    
    items.forEach((item, i) => {
      const div = document.createElement('div');
      div.className = "list-item";
      
      const textDiv = document.createElement('div');
      textDiv.className = "list-item-text";
      textDiv.textContent = item.text;
      
      const tagsDiv = document.createElement('div');
      tagsDiv.className = "list-item-tags";
      tagsDiv.textContent = item.tags.map(tag => `#${tag}`).join(' ');
      
      div.appendChild(textDiv);
      if (item.tags.length > 0) {
        div.appendChild(tagsDiv);
      }
      
      // Add native iOS touch behavior
      div.addEventListener('touchstart', () => {
        div.style.backgroundColor = 'var(--ios-gray6)';
      });
      
      div.addEventListener('touchend', () => {
        setTimeout(() => {
          div.style.backgroundColor = '';
        }, 150);
      });
      
      div.addEventListener('click', () => {
        triggerHaptic(div);
        if (item.tags.length > 0) {
          filterEl.value = item.tags[0];
          filterEl.focus();
        }
      });
      
      listEl.appendChild(div);
    });
  }
  
  function showResult(item) {
    resultEl.style.display = "block";
    resultEl.className = "result";
    
    const textDiv = document.createElement('div');
    textDiv.className = "result-text";
    textDiv.textContent = item.text;
    
    const tagsDiv = document.createElement('div');
    tagsDiv.className = "result-tags";
    tagsDiv.textContent = item.tags.map(tag => `#${tag}`).join(' ');
    
    resultEl.innerHTML = '';
    resultEl.appendChild(textDiv);
    if (item.tags.length > 0) {
      resultEl.appendChild(tagsDiv);
    }
  }
  
  function showError(message) {
    resultEl.style.display = "block";
    resultEl.className = "result";
    resultEl.innerHTML = `<div class="result-text">${message}</div>`;
  }
  
  // Event handlers
  parseBtn.addEventListener('click', () => {
    const text = bulk.value.trim();
    if (!text) return;
    
    triggerHaptic(parseBtn);
    parseBtn.classList.add('loading');
    parseBtn.disabled = true;
    
    setTimeout(() => {
      const lines = text.split(/\n/).map(parseLine).filter(Boolean);
      if (lines.length > 0) {
        items = items.concat(lines);
        save();
        render();
        bulk.value = "";
        
        // Provide feedback
        const originalText = parseBtn.textContent;
        parseBtn.textContent = `Added ${lines.length} idea${lines.length > 1 ? 's' : ''}`;
        setTimeout(() => {
          parseBtn.textContent = originalText;
        }, 1500);
      }
      
      parseBtn.classList.remove('loading');
      parseBtn.disabled = false;
    }, 200);
  });
  
  file.addEventListener('change', async (e) => {
    const f = e.target.files[0];
    if (!f) return;
    
    try {
      const text = await f.text();
      bulk.value = text;
      // Auto-resize textarea
      bulk.style.height = 'auto';
      bulk.style.height = Math.max(100, bulk.scrollHeight) + 'px';
    } catch (error) {
      showError('Could not read file');
    }
  });
  
  drawBtn.addEventListener('click', () => {
    triggerHaptic(drawBtn);
    
    if (items.length === 0) {
      showError('Add some date ideas first');
      return;
    }
    
    drawBtn.classList.add('loading');
    drawBtn.disabled = true;
    
    setTimeout(() => {
      const filterText = filterEl.value.trim().toLowerCase();
      let pool = items;
      
      if (filterText) {
        pool = items.filter(item => 
          item.tags.some(tag => tag.toLowerCase().includes(filterText)) ||
          item.text.toLowerCase().includes(filterText)
        );
      }
      
      if (pool.length === 0) {
        showError('No matches found');
      } else {
        const pick = pool[Math.floor(Math.random() * pool.length)];
        showResult(pick);
      }
      
      drawBtn.classList.remove('loading');
      drawBtn.disabled = false;
    }, 300);
  });
  
  sampleBtn.addEventListener('click', () => {
    triggerHaptic(sampleBtn);
    
    const sampleIdeas = [
      "Coffee shop date | casual, indoors",
      "Hiking trail | active, outdoors",
      "Cooking together | home, food",
      "Museum visit | cultural, indoors",
      "Picnic in the park | outdoor, relaxed",
      "Movie night | home, entertainment",
      "Farmers market | casual, outdoor",
      "Board game café | indoor, games",
      "Beach walk | outdoor, romantic",
      "Art gallery | cultural, indoor",
      "Mini golf | fun, active",
      "Wine tasting | sophisticated, indoor",
      "Bookstore browsing | quiet, indoor",
      "Dance class | active, learning",
      "Food truck tour | casual, outdoor"
    ];
    
    bulk.value = sampleIdeas.join('\n');
    // Auto-resize textarea
    bulk.style.height = 'auto';
    bulk.style.height = Math.max(100, bulk.scrollHeight) + 'px';
  });
  
  // Auto-resize textarea
  bulk.addEventListener('input', () => {
    bulk.style.height = 'auto';
    bulk.style.height = Math.max(100, bulk.scrollHeight) + 'px';
  });
  
  // Keyboard shortcuts
  bulk.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {
      e.preventDefault();
      parseBtn.click();
    }
  });
  
  filterEl.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      drawBtn.click();
    }
  });
  
  // Initialize
  render();
  
  // Service worker registration
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js')
        .catch(() => {
          // Silently fail - not critical for functionality
        });
    });
  }
})();
</script>
</body>
</html>